<?xml version="1.0" encoding="UTF-8"?>
<prompt>
  <metadata>
    <title>Smart Data Seeding: Clean &amp; Populate (Spanish)</title>
    <phase>Data Management</phase>
    <difficulty>medium</difficulty>
    <estimated_time>1-2 hours</estimated_time>
    <version>2.0</version>
    <last_updated>2025-11-25</last_updated>
    <prerequisites>
      <prerequisite>Access to local/staging database</prerequisite>
      <prerequisite>Faker.js or similar library (optional but recommended)</prerequisite>
    </prerequisites>
  </metadata>

  <thinking_configuration>
    <claude_extended_thinking>
      <enabled>true</enabled>
      <reasoning>
        Requires careful deletion logic (cascading deletes or specific order) to keep Users but remove their related data. Needs to generate realistic, context-aware data (vehicles, services) in Spanish.
      </reasoning>
      <budget_tokens>10000</budget_tokens>
      <expected_thinking_depth>
        Analyze the schema relationships to determine the correct deletion order. Design a data generation strategy that creates coherent stories for users (e.g., a user has a specific car and service history).
      </expected_thinking_depth>
    </claude_extended_thinking>
  </thinking_configuration>

  <context>
    <project_info>
      <name>Hugo Automotriz</name>
      <current_location>.</current_location>
      <framework>Next.js / Prisma</framework>
      <status>In Development</status>
    </project_info>
    <objective>
      <primary>
        Clean the database of all transactional data (requests, services, vehicles, etc.) while PRESERVING existing User records. Then, populate the database with realistic, high-quality test data in Spanish for those users.
      </primary>
      <success_criteria>
        <criterion>✅ All non-user tables are cleared (or cleaned of specific user data).</criterion>
        <criterion>✅ Existing users are preserved.</criterion>
        <criterion>✅ Database is populated with realistic vehicles, service requests, and history in Spanish.</criterion>
        <criterion>✅ Data relationships are valid (e.g., requests belong to existing users).</criterion>
      </success_criteria>
    </objective>
  </context>

  <instructions>
    <step number="1">
      <title>Implement Clean Up Logic</title>
      <thinking_guidance>
        Analyze `prisma/schema.prisma`. Identify tables dependent on `User` (e.g., `Vehicle`, `ServiceRequest`, `Ticket`).
        Determine the order of deletion to avoid foreign key constraint errors.
        **Crucial:** Ensure the `User` table itself is NOT truncated.
      </thinking_guidance>
      <action>
        Write a function in the seed script to delete all records from related tables (e.g., `prisma.vehicle.deleteMany()`, `prisma.serviceRequest.deleteMany()`), leaving the `User` table intact.
      </action>
      <validation>
        <execution_success>
          ✅ Script runs and removes related data.
          ✅ User count remains unchanged.
        </execution_success>
      </validation>
    </step>

    <step number="2">
      <title>Generate Realistic Spanish Data</title>
      <thinking_guidance>
        Plan the data generation:
        1.  **Vehicles:** Real brands/models popular in LATAM (e.g., Toyota Yaris, Nissan Versa, Chevrolet Sail).
        2.  **Services:** Use realistic terms in Spanish (e.g., "Cambio de Aceite", "Alineación y Balanceo", "Revisión de Frenos").
        3.  **Status:** Mix of statuses (Pending, In Progress, Completed, Cancelled).
        4.  **Dates:** Spread dates over the last few months to create a history.
      </thinking_guidance>
      <action>
        Update `prisma/seed.ts` to iterate through existing users and create:
        - 1-2 Vehicles per user.
        - 3-5 Service Requests per user (past and active).
        - Associated tickets/payments if applicable.
        Use realistic Spanish text for descriptions and notes.
      </action>
      <validation>
        <thinking_quality>
          Verify that the generated data looks "human" and not just random strings.
        </thinking_quality>
        <execution_success>
          ✅ Database is populated with rich, Spanish data linked to existing users.
        </execution_success>
      </validation>
    </step>
  </instructions>

  <output_format>
    <structure>
      <section name="execution_log">
        Log of tables cleaned and data generated.
      </section>
      <section name="results">
        Summary of the new database state (counts of vehicles, requests, etc.).
      </section>
    </structure>
    <format>Markdown</format>
  </output_format>
</prompt>
